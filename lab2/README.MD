# Docker Compose Проект

Этот проект использует `docker-compose` для запуска трех сервисов: базы данных PostgreSQL, основного приложения Flask и инициализационного сервиса для проверки работоспособности системы.

---

## Файл `docker-compose.yml`

### Сервисы

#### 1. `db` (База данных)

- **Образ**: `postgres:16.3`  
  Используется стабильная версия PostgreSQL 16.3 для управления базой данных.

- **Переменные окружения**:  
  - `POSTGRES_USER`: Имя пользователя для подключения к базе данных (читается из файла `.env`).
  - `POSTGRES_PASSWORD`: Пароль пользователя для подключения к базе данных (читается из `.env`).
  - `POSTGRES_DB`: Имя базы данных, создаваемой при старте контейнера (читается из `.env`).

- **Volume**:  
  - `db_data:/var/lib/postgresql/data` — данные базы сохраняются в volume, что обеспечивает их сохранность между перезапусками контейнера.

- **Healthcheck**:  
  Проверяет готовность базы данных для работы:
  - Команда: `pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}`.
  - Интервал: 10 секунд.
  - Тайм-аут: 5 секунд.
  - Повторные попытки: 3.

- **Сеть**:  
  Подключен к сети `my_network`.

---

#### 2. `app` (Основное приложение)

- **Сборка**:  
  Сервис собирается из локального каталога `./app`, используя `Dockerfile`.

- **Порты**:  
  - Приложение внутри контейнера работает на порту `5000`. Этот порт проброшен наружу на `5012`, чтобы обеспечить доступ с хоста.

- **Зависимости (`depends_on`)**:  
  Сервис зависит от базы данных (`db`), гарантируя, что `db` будет запущена до запуска `app`.

- **Переменные окружения**:  
  Загружаются из файла `.env`.

- **Сеть**:  
  Подключен к сети `my_network`.

---

#### 3. `init` (Инициализационный сервис (а-ля пост-инит))

- **Сборка**:  
  Сервис собирается из локального каталога `./init`, используя `Dockerfile`.

- **Зависимости (`depends_on`)**:  
  Сервис зависит как от приложения (`app`), так и от базы данных (`db`). Это обеспечивает выполнение `init` только после запуска других контейнеров.

- **Переменные окружения**:  
  Загружаются из файла `.env`.

- **Сеть**:  
  Подключен к сети `my_network`.

---

### Volumes

- **`db_data`**:  
  Используется для сохранения данных базы между перезапусками.

---

### Networks

- **`my_network`**:  
  Одна общая сеть для всех сервисов, обеспечивающая их взаимодействие.

---

### Общее

- Переменные окружения, такие как учетные данные базы данных и порты, вынесены в файл `.env` для удобства и гибкости конфигурации.
- Порядок запуска контейнеров определен с помощью `depends_on`, что позволяет сначала поднять базу данных и приложение, а затем init сервис.
- Заданы healthcheck и volume для повышения надежности системы.
